#include "zf_driver_file_string.hpp"
#include <stdio.h>

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 构造函数
// 参数说明 path  文件路径
// 参数说明 mode  文件打开模式
// 返回参数 无
// 使用示例 zf_driver_file_string file_obj("/sys/class/adc/value", "r");
// 备注信息 路径为空则不执行文件打开操作
//-------------------------------------------------------------------------------------------------------------------
zf_driver_file_string::zf_driver_file_string(const char* path, const char* mode)
    : m_path(path), m_fp(NULL)
{
    if(m_path != NULL)
    {
        m_fp = fopen(m_path, mode);
    }
}

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 析构函数
// 参数说明 无
// 返回参数 无
// 使用示例 自动调用，无需手动调用
// 备注信息 自动关闭文件指针，防止文件句柄资源泄露
//-------------------------------------------------------------------------------------------------------------------
zf_driver_file_string::~zf_driver_file_string()
{
    if(m_fp != NULL)
    {
        fclose(m_fp);
        m_fp = NULL;
    }
}

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 重新设置文件路径并打开文件
// 参数说明 path  文件路径
// 参数说明 mode  文件打开模式
// 返回参数 无
// 使用示例 file_obj.set_path("/sys/class/adc/scale", "r+");
// 备注信息 先关闭原有文件，再重新打开新路径文件
//-------------------------------------------------------------------------------------------------------------------
void zf_driver_file_string::set_path(const char* path, const char* mode)
{
    if(m_fp != NULL)
    {
        fclose(m_fp);
        m_fp = NULL;
    }
    m_path = path;
    if(m_path != NULL)
    {
        m_fp = fopen(m_path, mode);
    }
}

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 从文件读取字符串数据
// 参数说明 str  存储读取数据的字符数组指针
// 返回参数 int8 0-读取成功  -1-读取失败
// 使用示例 char buf[64]={0}; file_obj.read_string(buf);
// 备注信息 按空格/换行符作为结束符，读取单个字符串
//-------------------------------------------------------------------------------------------------------------------
int8 zf_driver_file_string::read_string(char *str)
{
    if(m_fp == NULL || str == NULL)
        return -1;

    if(fscanf(m_fp, "%s", str) > 0)
        return 0;
    else
        return -1;
}

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 重新定位文件指针到文件开头
// 参数说明 无
// 返回参数 无
// 使用示例 file_obj.rewind_file();
// 备注信息 无
//-------------------------------------------------------------------------------------------------------------------
void  zf_driver_file_string::rewind_file(void)
{
    if(m_fp != NULL)
    {
        rewind(m_fp);
    }
}

//-------------------------------------------------------------------------------------------------------------------
// 函数简介 向文件写入字符串数据
// 参数说明 str  待写入的字符串指针
// 返回参数 int8 0-写入成功  -1-写入失败
// 使用示例 char buf[]="123456"; file_obj.write_string(buf);
// 备注信息 写入完整字符串，不含自动换行符
//-------------------------------------------------------------------------------------------------------------------
int8 zf_driver_file_string::write_string(char *str)
{
    if(m_fp == NULL || str == NULL)
        return -1;

    if(fputs(str, m_fp) >= 0)
        return 0;
    else
        return -1;
}